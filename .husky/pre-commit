#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Pre-commit 훅 실행 중..."

# lint-staged 실행 (자동 수정 시도)
echo "📝 코드 포맷팅 및 린트 검사..."
if ! npx lint-staged; then
  echo "⚠️  일부 린트/포맷팅 문제가 있지만 커밋을 계속합니다."
  echo "🔧 다음 명령어로 나중에 수정하세요:"
  echo "   npm run lint -- --fix"
  echo "   npx prettier --write ."
fi

# AI 리뷰 실행 (환경 변수가 설정된 경우에만)
if [ "$AI_REVIEW" = "true" ]; then
  echo "🤖 AI 리뷰를 시작합니다..."
  if ! node scripts/ai-review.js; then
    echo "❌ AI 리뷰에서 문제가 발견되어 커밋이 차단되었습니다."
    exit 1
  fi
elif [ "$OPENAI_REVIEW" = "true" ]; then
  echo "🤖 OpenAI AI 리뷰를 시작합니다..."
  if ! node scripts/ai-review-openai.js; then
    echo "❌ OpenAI AI 리뷰에서 문제가 발견되어 커밋이 차단되었습니다."
    exit 1
  fi
else
  echo "ℹ️  AI 리뷰를 건너뜁니다. (AI 리뷰를 원하면 AI_REVIEW=true 또는 OPENAI_REVIEW=true로 설정하세요)"
fi

echo "✅ Pre-commit 훅 완료"
